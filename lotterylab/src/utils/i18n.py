"""
Internationalization (i18n) utilities for Lottery Lab.

Supports Polish (default) and English languages.
Uses Babel for translation management.
"""

from __future__ import annotations
from pathlib import Path
from typing import Optional
from functools import lru_cache

from babel import Locale
from babel.support import Translations

# Supported languages
SUPPORTED_LANGUAGES = ['pl', 'en']
DEFAULT_LANGUAGE = 'pl'

# Translations directory
TRANSLATIONS_DIR = Path(__file__).resolve().parents[2] / 'translations'


@lru_cache(maxsize=10)
def get_translations(language: str) -> Translations:
    """
    Load translations for a given language.
    
    Args:
        language: Language code ('pl', 'en')
        
    Returns:
        Translations object for the language
    """
    if language not in SUPPORTED_LANGUAGES:
        language = DEFAULT_LANGUAGE
    
    try:
        return Translations.load(
            dirname=str(TRANSLATIONS_DIR),
            locales=[language]
        )
    except Exception:
        # Fallback to NullTranslations if loading fails
        return Translations()


def get_locale(language: str) -> Locale:
    """
    Get Babel Locale object for a language.
    
    Args:
        language: Language code ('pl', 'en')
        
    Returns:
        Babel Locale object
    """
    if language not in SUPPORTED_LANGUAGES:
        language = DEFAULT_LANGUAGE
    return Locale.parse(language)


def detect_language(
    cookie_lang: Optional[str] = None,
    query_lang: Optional[str] = None,
    accept_language: Optional[str] = None
) -> str:
    """
    Detect user's preferred language from various sources.
    
    Priority:
    1. Query parameter (?lang=en)
    2. Cookie (lang=pl)
    3. Accept-Language header
    4. Default (pl)
    
    Args:
        cookie_lang: Language from cookie
        query_lang: Language from query parameter
        accept_language: Accept-Language header value
        
    Returns:
        Detected language code
    """
    # 1. Query parameter has highest priority
    if query_lang and query_lang in SUPPORTED_LANGUAGES:
        return query_lang
    
    # 2. Cookie
    if cookie_lang and cookie_lang in SUPPORTED_LANGUAGES:
        return cookie_lang
    
    # 3. Accept-Language header
    if accept_language:
        # Parse Accept-Language header (e.g., "pl-PL,pl;q=0.9,en;q=0.8")
        for lang_part in accept_language.split(','):
            lang_code = lang_part.split(';')[0].strip().split('-')[0].lower()
            if lang_code in SUPPORTED_LANGUAGES:
                return lang_code
    
    # 4. Default
    return DEFAULT_LANGUAGE


# UI text translations (fallback before .po files are ready)
# This will be replaced by proper .po/.mo files
UI_TEXTS = {
    'en': {
        'site_title': 'Lottery Lab',
        'tagline': 'Where Luck Meets Science',
        'nav_overview': 'Overview',
        'nav_analysis': 'Analysis',
        'nav_experiments': 'Experiments',
        'nav_docs': 'Docs',
        'new_study': 'New Study',
        'controls': 'Controls',
        'game_type_label': 'Game type',
        'window_days_label': 'Window (days)',
        'methods': 'Methods',
        'frequency_analysis': 'Frequency analysis',
        'randomness_tests': 'Randomness tests',
        'number_generator': 'Number generator',
        'pattern_analysis': 'Pattern analysis',
        'correlation_heatmap': 'Correlation heatmap',
        'hypothesis_tests': 'Hypothesis tests',
        'statistical_analysis': 'Statistical analysis of draws',
        'explore_frequency': 'Explore frequency distributions and compare with the expected uniform baseline.',
        'tip': 'Tip',
        'tip_window': 'Use shorter windows (e.g. 90 days) to emphasize recency; longer windows smooth variance.',
        'loading': 'Loading…',
        'loading_recent': 'Loading recent draws…',
        'footer': 'Research & Education',
        'hot_numbers_title': 'Hot Numbers',
        'cold_numbers_title': 'Cold Numbers',
        'hot_desc': 'Appearing more frequently than expected',
        'cold_desc': 'Appearing less frequently than expected',
        'view_all': 'View All Numbers',
        'draws': 'Draws',
        'expected_each': 'Expected each',
        'days': 'days',
        'recent_draws': 'Recent Draws',
        'draw_number': 'Draw #',
        'date': 'Date',
        'numbers': 'Numbers',
        'type': 'Type',
        'game': 'Game',
        'provider': 'Provider',
        # Randomness Analysis
        'randomness_title': 'Randomness Analysis',
        'randomness_subtitle': 'Statistical tests to determine if lottery draws follow expected random patterns',
        'appears_random': 'Appears Random',
        'not_random': 'Not Random',
        'chi_square_title': 'Chi-Square Goodness-of-Fit Test',
        'ks_title': 'Kolmogorov-Smirnov Test',
        'runs_title': 'Runs Test (Sequence Randomness)',
        'autocorr_title': 'Autocorrelation Analysis',
        'p_value': 'p-value',
        'significant': 'Significant',
        'not_significant': 'Not significant',
        'test_statistic': 'Test statistic',
        'degrees_freedom': 'Degrees of Freedom',
        'sample_info': 'Sample Information',
        'total_draws': 'Total Draws',
        'total_numbers': 'Total Numbers',
        'coverage': 'Coverage',
        'entropy_title': 'Information Entropy',
        'low_randomness': 'Low Randomness',
        'high_randomness': 'High Randomness',
        'shannon_entropy': 'Shannon Entropy',
        'bits_per_number': 'bits per number',
        'max_possible': 'Maximum Possible',
        'interpretation': 'Statistical Interpretation',
        'educational_note': 'Educational Note',
        'educational_disclaimer': 'This analysis tests for statistical randomness, not prediction power. Even truly random systems can show temporary patterns in finite samples. Lottery outcomes remain unpredictable regardless of statistical properties.',
        # Pattern Analysis
        'pattern_title': 'Pattern Analysis',
        'pattern_subtitle': 'Detection of statistical patterns and sequences in lottery draws',
        'consecutive_title': 'Consecutive Numbers',
        'arithmetic_title': 'Arithmetic Sequences',
        'digit_title': 'Digit Analysis',
        'sum_title': 'Sum Analysis',
        'sequences_found': 'sequences found',
        'total_sequences': 'Total Sequences',
        'max_length': 'Max Length',
        'avg_length': 'Avg Length',
        'found_sequences': 'Found Sequences',
        # Correlation Analysis
        'correlation_title': 'Number Correlation Analysis',
        'correlation_subtitle': 'Exploring relationships and clustering patterns between lottery numbers',
        'correlation_overview': 'Correlation Overview',
        'draws_analyzed': 'draws analyzed',
        'numbers_analyzed': 'Numbers Analyzed',
        'avg_correlation': 'Avg Correlation',
        'strongest_link': 'Strongest Link',
        'top_pairs': 'Top Correlated Number Pairs',
        'analysis_insights': 'Analysis Insights',
        # Generator
        'generator_title': 'Number Generator',
        'generator_desc': 'Generate a number set based on recent frequency analysis. This favors recently hot numbers while avoiding extreme cold numbers.',
        'your_set': 'Your Generated Set',
        'generate_new': 'Generate New Set',
        'hot': 'hot',
        'neutral': 'neutral',
        'cold': 'cold',
        'generator_disclaimer': 'This is for entertainment only. Lottery outcomes are truly random.',
        # Time Series Trends
        'time_series': 'Time Series',
        'trends_title': 'Time Series Trend Analysis',
        'trends_subtitle': 'Analyze how number frequencies change over time and identify trending patterns',
        'period_controls': 'Period Settings',
        'period_type_label': 'Period Type',
        'period_week': 'Week',
        'period_month': 'Month',
        'period_quarter': 'Quarter',
        'num_periods_label': 'Number of Periods',
        'update_chart': 'Update Chart',
        'trend_overview': 'Trend Overview',
        'periods_analyzed': 'Periods Analyzed',
        'strongly_trending': 'Strongly Trending',
        'stable_numbers': 'Stable Numbers',
        'numbers_with_strong_trend': 'Numbers with significant trend',
        'numbers_without_trend': 'Numbers without clear trend',
        'hot_and_cold_trends': 'Hot & Cold Trends',
        'increasing_label': 'Increasing Numbers',
        'decreasing_label': 'Decreasing Numbers',
        'increasing_desc': 'Numbers appearing more frequently over time',
        'decreasing_desc': 'Numbers appearing less frequently over time',
        'no_increasing_trends': 'No significantly increasing trends found',
        'no_decreasing_trends': 'No significantly decreasing trends found',
        'time_series_chart': 'Frequency Over Time',
        'chart_info': 'Line chart showing frequency changes across periods',
        'streak_analysis_title': 'Streak Analysis',
        'hot_streaks': 'Hot Streaks',
        'cold_streaks': 'Cold Streaks',
        'hot_streaks_desc': 'Numbers currently on appearance streaks',
        'cold_streaks_desc': 'Numbers absent for multiple draws',
        'consecutive_draws': 'consecutive draws',
        'draws_absent': 'draws absent',
        'max_streak': 'Max streak',
        'max_absence': 'Max absence',
        'no_hot_streaks': 'No active hot streaks',
        'no_cold_streaks': 'No notable cold streaks',
        'longest_appearance': 'Longest Appearance Streak',
        'longest_absence': 'Longest Absence Streak',
        'insights_title': 'Insights',
        'trend_interpretation': 'Trend Interpretation',
        'increasing_trend': 'Increasing trend',
        'decreasing_trend': 'Decreasing trend',
        'stable_trend': 'Stable pattern',
        'increasing_interpretation': 'Number is appearing more frequently in recent periods',
        'decreasing_interpretation': 'Number is appearing less frequently in recent periods',
        'stable_interpretation': 'No significant change in appearance frequency',
        'statistical_method': 'Statistical Method',
        'trend_method_desc': 'Trends are calculated using linear regression on period frequencies.',
        'r_squared_desc': 'R² indicates how well the trend line fits the data (1.0 = perfect fit).',
        'important_note': 'Important Note',
        'gambler_fallacy_warning': 'Past trends do not predict future outcomes. This is the Gambler\'s Fallacy. Each lottery draw is independent and random.',
        'number_label': 'Number',
        'frequency_over_time': 'Number Frequency Over Time',
        'period_label': 'Period',
        'frequency_label': 'Frequency',
        # Export
        'export_reports': 'Export Reports',
        'download_pdf': 'Download PDF',
        'download_excel': 'Download Excel',
        # Progress Bar
        'prev_topic': 'Previous topic',
        'next_topic': 'Next topic',
        'progress_text': 'of 7 topics',
        # Right Panel
        'on_this_page': 'On this page',
        'related_topics': 'Related topics',
        'additional_materials': 'Additional materials',
        'binomial_distribution': 'Binomial distribution',
        'law_of_large_numbers': 'Law of large numbers',
        'central_limit_theorem': 'Central limit theorem',
        # Monte Carlo Demo
        'monte_carlo_title': 'Monte Carlo Simulation',
        'monte_carlo_desc': 'Run multiple simulations and observe convergence to theoretical distribution.',
        'num_simulations': 'Number of simulations',
        'run_simulation': 'Run Simulation',
        'running': 'Running...',
        'sim_chi_square': 'Avg χ²',
        'sim_p_value': 'Avg p-value',
        'sim_random_pct': '% Random',
        # Hypothesis Testing
        'hypothesis_test_title': 'Statistical Hypothesis Test',
        'null_hypothesis': 'Null Hypothesis (H₀)',
        'alt_hypothesis': 'Alternative Hypothesis (H₁)',
        'h0_value': 'Uniform Distribution',
        'h0_desc': 'The distribution of numbers in the lottery follows a uniform distribution with equal probability for each number.',
        'h1_value': 'Non-uniform Distribution',
        'h1_desc': 'The distribution of numbers in the lottery shows non-random patterns or deviations from uniform distribution.',
        'fail_to_reject': 'FAIL TO REJECT',
        'rejected': 'NOT SIGNIFICANT',
        # Formula Box
        'formula_section_title': 'Statistical Methods',
        'formula_chi_square_title': 'Chi-Square Goodness-of-Fit:',
        'formula_chi_square': 'χ² = Σ [(O - E)² / E]',
        'formula_chi_square_desc': 'O = observed frequency, E = expected frequency',
        'formula_entropy_title': 'Shannon Entropy:',
        'formula_entropy': 'H = -Σ p(x) · log₂ p(x)',
        'formula_entropy_desc': 'p(x) = probability of number x appearing',
        # Stats Grid
        'key_metrics': 'Key Metrics',
        'stat_sample_size': 'Sample Size',
        'stat_sample_desc': 'Historical draws analyzed',
        'stat_observations': 'Observations',
        'stat_observations_desc': 'Total numbers drawn',
        'stat_chi_square': 'Chi-Square Test',
        'stat_entropy': 'Entropy Level',
        'stat_entropy_unit': 'Shannon entropy (bits)',
        'stat_coverage': 'Number Coverage',
        'stat_coverage_desc': 'All 49 numbers represented',
        'stat_confidence': 'Confidence Interval',
        'stat_confidence_desc': '95% CI for frequency distribution',
        # Homepage
        'features': 'Features',
        'how_it_works': 'How it works',
        'methodology': 'Methodology',
        'docs': 'Documentation',
        'toggle_theme': 'Toggle theme',
        'open_analyzer': 'Open analyzer',
        'hero_title_1': 'Where',
        'hero_title_highlight': 'luck',
        'hero_title_2': 'meets science',
        'hero_subtitle': 'Explore the mathematical secrets of lotteries. Analyze 68 years of historical data, test statistical hypotheses, and discover why randomness is beautiful.',
        'disclaimer_title': 'This is not a prediction system.',
        'disclaimer_text': 'Lottery Lab is an educational tool for statistical analysis. Lottery results are random and unpredictable — and that\'s exactly what we study.',
        'start_analysis': 'Start analysis',
        'learn_more': 'Learn more',
        'stat_draws': 'Historical draws',
        'years': 'years',
        'stat_data_since': 'Data since 1957',
        'stat_methods': 'Statistical methods',
        'hottest': 'Hottest',
        'coldest': 'Coldest',
        'chi_square': 'Chi² test',
        'entropy': 'Entropy',
        'features_title': 'What can you explore?',
        'features_subtitle': 'A set of statistical tools for reliable lottery data analysis',
        'feature_frequency_title': 'Frequency analysis',
        'feature_frequency_desc': 'Check how often each number appears. Compare with theoretical distribution and see "hot" and "cold" numbers.',
        'feature_randomness_title': 'Randomness tests',
        'feature_randomness_desc': 'Chi-square, Kolmogorov-Smirnov, runs test — check if draws are truly random.',
        'feature_patterns_title': 'Patterns and sequences',
        'feature_patterns_desc': 'Look for consecutive number sequences, arithmetic progressions, and other potential patterns.',
        'feature_correlation_title': 'Correlation map',
        'feature_correlation_desc': 'Visualize relationships between numbers. Do some pairs appear together more often than by chance?',
        'feature_trends_title': 'Time trends',
        'feature_trends_desc': 'Analyze changes over time — weekly, monthly, and quarterly frequency trends.',
        'feature_generator_title': 'Number generator',
        'feature_generator_desc': 'Draw number sets with different strategies. Remember: every combination has the same probability!',
        'explore': 'Explore',
        'test': 'Test',
        'analyze': 'Analyze',
        'view_map': 'View map',
        'observe': 'Observe trends',
        'generate': 'Generate',
        'how_it_works_title': 'How does it work?',
        'how_it_works_subtitle': 'A rigorous scientific approach in 4 steps',
        'step1_title': 'We collect data',
        'step1_desc': 'Historical results since 1957, automatically updated after each draw.',
        'step2_title': 'We formulate a hypothesis',
        'step2_desc': 'H₀: "Lottery results are completely random" — this is what we test statistically.',
        'step3_title': 'We run tests',
        'step3_desc': 'We use recognized statistical methods: chi-square, KS, autocorrelation, entropy.',
        'step4_title': 'We interpret results',
        'step4_desc': 'Do the data support randomness? (Spoiler: yes — and that\'s good news!)',
        'footer_tagline': 'Research & Education. Open-source project under MIT license.',
        # Methodology Page
        'home': 'Home',
        'analyzer': 'Analyzer',
        'meth_scientific_approach': 'Scientific approach to analysis',
        'meth_title': 'Research Methodology',
        'meth_subtitle': 'Learn the statistical methods that allow rigorous examination of lottery randomness. Each method based on recognized mathematical theory.',
        'meth_stat_methods': 'Statistical methods',
        'meth_significance_level': 'Significance level',
        'meth_historical_data': 'Historical data',
        'meth_null_hypothesis': 'Null Hypothesis (H₀)',
        'meth_h0_text_1': 'Lottery results are',
        'meth_h0_highlight_1': 'completely random',
        'meth_h0_text_2': 'and',
        'meth_h0_highlight_2': 'independent',
        'meth_h0_text_3': 'each number has the same probability of being drawn.',
        'meth_h0_desc': 'This is what we test. If the data does not provide grounds to reject H₀, the lottery works correctly. And that is exactly what we observe!',
        'meth_methods_title': 'Analysis Methods',
        'meth_methods_subtitle': 'Click on a card to learn details of the method',
        'meth_chi_title': 'Chi-Square Test',
        'meth_chi_question': 'Is the frequency distribution uniform?',
        'meth_chi_desc': 'Compares observed frequencies with expected ones. Checks if deviations are within natural random variation.',
        'meth_ks_title': 'Kolmogorov-Smirnov Test',
        'meth_ks_question': 'Does the distribution match the theoretical one?',
        'meth_ks_desc': 'Compares empirical distribution with theoretical. Sensitive to differences in distribution shape, not just mean.',
        'meth_runs_title': 'Runs Test',
        'meth_runs_question': 'Are sequences random?',
        'meth_runs_desc': 'Checks for excessively long runs (e.g., only high numbers in a row). Detects hidden patterns in result order.',
        'meth_autocorr_title': 'Autocorrelation',
        'meth_autocorr_question': 'Does the past affect the future?',
        'meth_autocorr_desc': 'Measures dependencies between results separated in time. If lottery is random, autocorrelation should be near zero.',
        'meth_entropy_title': 'Shannon Entropy',
        'meth_entropy_question': 'How unpredictable are the results?',
        'meth_entropy_desc': 'Measures "amount of surprise" in data. Maximum entropy = maximum randomness. For Lotto 6/49: max = 5.61 bits.',
        'meth_monte_title': 'Monte Carlo Simulations',
        'meth_monte_question': 'What if we repeated 10,000 times?',
        'meth_monte_desc': 'We generate thousands of artificial draws and compare with real ones. Shows that real data falls within simulation bounds.',
        'meth_monte_formula': 'Simulation → Comparison → Conclusions',
        'meth_for_lotto': 'for Lotto PL',
        'meth_no_significant_lags': 'No significant lags',
        'meth_data_in_ci': 'Data in 95% CI',
        'meth_read_more': 'Read more',
        'meth_workflow_title': 'How do we conduct analysis?',
        'meth_step1': 'Collect data',
        'meth_step1_desc': 'Historical results from official sources',
        'meth_step2': 'Validate',
        'meth_step2_desc': 'Check correctness and completeness',
        'meth_step3': 'Test',
        'meth_step3_desc': 'Apply all 6 statistical methods',
        'meth_step4': 'Visualize',
        'meth_step4_desc': 'Present results in accessible way',
        'meth_lotteries_title': 'Supported Lotteries',
        'meth_lotteries_subtitle': 'The methodology is universal — works for any number lottery',
        'meth_status_active': 'Active',
        'meth_status_soon': 'Soon',
        'meth_status_planned': 'Planned',
        'meth_cta_title': 'Ready to analyze?',
        'meth_cta_desc': 'Try all methods on real data. See for yourself that the lottery is fair!',
        'meth_start_basics': 'Start with basics',
        # Chi-square detail page
        'meth_tests_title': 'Statistical Tests',
        'meth_your_progress': 'Your progress',
        'meth_of': 'of',
        'meth_chapters': 'chapters',
        'chi_subtitle': 'Check if the frequency distribution matches the theoretical distribution. One of the most powerful randomness tests.',
        'chi_intuition_title': 'Intuition',
        'chi_intuition_p1': 'Imagine rolling a die 600 times. If the die is fair, each number should appear about 100 times (600 ÷ 6).',
        'chi_intuition_p2': 'But exactly 100? No! Randomness means there will be natural deviations. Maybe 95 ones, 108 twos, 97 threes...',
        'chi_intuition_question': 'The chi-square test answers the question:',
        'chi_intuition_answer': '"Are these deviations within what we\'d expect from a fair die, or are they suspiciously large?"',
        'chi_accept_h0': 'Accept H₀',
        'chi_accept_desc': 'Deviations are normal for a random process',
        'chi_reject_h0': 'Reject H₀',
        'chi_reject_desc': 'Deviations are too large — something is wrong',
        'chi_formula_title': 'Mathematical Formula',
        'chi_statistic': 'Chi-square statistic',
        'chi_observed': 'observed frequency',
        'chi_expected': 'expected frequency',
        'chi_formula_explanation': 'For each number from 1 to 49, we calculate the difference between how many times it appeared (Observed) and how many times it should appear (Expected). We square it (to eliminate negatives) and divide by the expected value (normalization).',
        'chi_step1_title': 'Count frequencies',
        'chi_step1_desc': 'For each of the 49 numbers, count how many times it appeared in the analyzed period',
        'chi_step2_title': 'Calculate expected',
        'chi_step2_desc': 'E = (number of draws × 6) ÷ 49 — this is how many times each number should appear',
        'chi_step3_title': 'Apply the formula',
        'chi_step3_desc': 'For each number calculate (O-E)²/E and sum all results',
        'chi_step4_title': 'Compare with χ² distribution',
        'chi_step4_desc': 'Check p-value: if > 0.05, data is consistent with randomness',
        'chi_demo_title': 'Try it yourself',
        'chi_simulator_title': 'Chi-square test simulator',
        'chi_simulator_desc': 'Run virtual draws and see the results',
        'chi_num_draws': 'Number of draws',
        'chi_run_simulation': 'Run simulation',
        'chi_verdict': 'Verdict',
        'chi_random': 'RANDOM',
        'chi_suspicious': 'SUSPICIOUS',
        'chi_interpret_title': 'How to interpret results?',
        'chi_lotto_result': 'Result for Polish Lotto (9,300+ draws)',
        'chi_lotto_result_desc': 'For historical Lotto data we get p-value ≈ 0.52, which means there are no grounds to reject the randomness hypothesis. The number distribution matches expectations — the lottery is fair!',
        'chi_warning_title': 'Watch out for misinterpretation',
        'chi_warning_desc': 'A high p-value does NOT mean we can predict future results. On the contrary — it confirms that each draw is independent and unpredictable. This is good news: the lottery works as it should!',
        'chi_code_title': 'Implementation',
        'chi_code_docstring': 'Chi-square test for frequency distribution.',
        'chi_code_comment1': 'uniform distribution',
        'chi_code_comment2': 'degrees of freedom',
        'chi_on_this_page': 'On this page',
        'chi_tip_text': 'The larger the sample (more draws), the more reliable the test. For 100 draws the result may be random; for 9,000+ it is very certain.',
        'chi_related': 'Related topics',
    },
    'pl': {
        'site_title': 'Lottery Lab',
        'tagline': 'Gdzie Szczęście Spotyka Naukę',
        'nav_overview': 'Przegląd',
        'nav_analysis': 'Analiza',
        'nav_experiments': 'Eksperymenty',
        'nav_docs': 'Dokumentacja',
        'new_study': 'Nowe badanie',
        'controls': 'Kontrolki',
        'game_type_label': 'Typ gry',
        'window_days_label': 'Okno (dni)',
        'methods': 'Metody',
        'frequency_analysis': 'Analiza częstości',
        'randomness_tests': 'Testy losowości',
        'number_generator': 'Generator liczb',
        'pattern_analysis': 'Analiza wzorców',
        'correlation_heatmap': 'Mapa korelacji',
        'hypothesis_tests': 'Testy hipotez',
        'statistical_analysis': 'Analiza statystyczna losowań',
        'explore_frequency': 'Eksploruj rozkłady częstości i porównaj z oczekiwanym rozkładem jednostajnym.',
        'tip': 'Wskazówka',
        'tip_window': 'Krótsze okna (np. 90 dni) podkreślają aktualność; dłuższe wygładzają wariancję.',
        'loading': 'Ładowanie…',
        'loading_recent': 'Ładowanie ostatnich losowań…',
        'footer': 'Badania i Edukacja',
        'hot_numbers_title': 'Gorące liczby',
        'cold_numbers_title': 'Zimne liczby',
        'hot_desc': 'Pojawiają się częściej niż oczekiwano',
        'cold_desc': 'Pojawiają się rzadziej niż oczekiwano',
        'view_all': 'Pokaż wszystkie liczby',
        'draws': 'Losowania',
        'expected_each': 'Oczekiwana częstość',
        'days': 'dni',
        'recent_draws': 'Ostatnie losowania',
        'draw_number': 'Nr losowania',
        'date': 'Data',
        'numbers': 'Liczby',
        'type': 'Typ',
        'game': 'Gra',
        'provider': 'Dostawca',
        # Randomness Analysis
        'randomness_title': 'Analiza losowości',
        'randomness_subtitle': 'Testy statystyczne sprawdzające czy losowania podążają za oczekiwanymi wzorcami losowymi',
        'appears_random': 'Wygląda na losowe',
        'not_random': 'Nie jest losowe',
        'chi_square_title': 'Test Chi-kwadrat dopasowania',
        'ks_title': 'Test Kołmogorowa-Smirnowa',
        'runs_title': 'Test serii (losowość sekwencji)',
        'autocorr_title': 'Analiza autokorelacji',
        'p_value': 'wartość p',
        'significant': 'Istotne',
        'not_significant': 'Nieistotne',
        'test_statistic': 'Statystyka testowa',
        'degrees_freedom': 'Stopnie swobody',
        'sample_info': 'Informacje o próbce',
        'total_draws': 'Liczba losowań',
        'total_numbers': 'Liczba liczb',
        'coverage': 'Pokrycie',
        'entropy_title': 'Entropia informacyjna',
        'low_randomness': 'Niska losowość',
        'high_randomness': 'Wysoka losowość',
        'shannon_entropy': 'Entropia Shannona',
        'bits_per_number': 'bitów na liczbę',
        'max_possible': 'Maksimum możliwe',
        'interpretation': 'Interpretacja statystyczna',
        'educational_note': 'Nota edukacyjna',
        'educational_disclaimer': 'Ta analiza testuje losowość statystyczną, nie zdolność przewidywania. Nawet prawdziwie losowe systemy mogą wykazywać tymczasowe wzorce w skończonych próbkach. Wyniki loterii pozostają nieprzewidywalne niezależnie od właściwości statystycznych.',
        # Pattern Analysis
        'pattern_title': 'Analiza wzorców',
        'pattern_subtitle': 'Wykrywanie statystycznych wzorców i sekwencji w losowaniach',
        'consecutive_title': 'Liczby kolejne',
        'arithmetic_title': 'Ciągi arytmetyczne',
        'digit_title': 'Analiza cyfr',
        'sum_title': 'Analiza sum',
        'sequences_found': 'sekwencji znaleziono',
        'total_sequences': 'Łączna liczba sekwencji',
        'max_length': 'Maks. długość',
        'avg_length': 'Średnia długość',
        'found_sequences': 'Znalezione sekwencje',
        # Correlation Analysis
        'correlation_title': 'Analiza korelacji liczb',
        'correlation_subtitle': 'Badanie zależności i wzorców grupowania między liczbami loterii',
        'correlation_overview': 'Przegląd korelacji',
        'draws_analyzed': 'losowań przeanalizowano',
        'numbers_analyzed': 'Przeanalizowano liczb',
        'avg_correlation': 'Średnia korelacja',
        'strongest_link': 'Najsilniejszy związek',
        'top_pairs': 'Najbardziej skorelowane pary',
        'analysis_insights': 'Wnioski z analizy',
        # Generator
        'generator_title': 'Generator liczb',
        'generator_desc': 'Generuj zestaw liczb na podstawie analizy częstości. Preferuje ostatnio gorące liczby, unikając skrajnie zimnych.',
        'your_set': 'Twój wygenerowany zestaw',
        'generate_new': 'Generuj nowy zestaw',
        'hot': 'gorące',
        'neutral': 'neutralne',
        'cold': 'zimne',
        'generator_disclaimer': 'To tylko rozrywka. Wyniki loterii są naprawdę losowe.',
        # Time Series Trends
        'time_series': 'Analiza czasowa',
        'trends_title': 'Analiza trendów czasowych',
        'trends_subtitle': 'Analizuj jak częstość liczb zmienia się w czasie i identyfikuj trendy',
        'period_controls': 'Ustawienia okresu',
        'period_type_label': 'Typ okresu',
        'period_week': 'Tydzień',
        'period_month': 'Miesiąc',
        'period_quarter': 'Kwartał',
        'num_periods_label': 'Liczba okresów',
        'update_chart': 'Aktualizuj wykres',
        'trend_overview': 'Przegląd trendów',
        'periods_analyzed': 'Przeanalizowano okresów',
        'strongly_trending': 'Silne trendy',
        'stable_numbers': 'Stabilne liczby',
        'numbers_with_strong_trend': 'Liczby z istotnym trendem',
        'numbers_without_trend': 'Liczby bez wyraźnego trendu',
        'hot_and_cold_trends': 'Trendy gorące i zimne',
        'increasing_label': 'Liczby rosnące',
        'decreasing_label': 'Liczby malejące',
        'increasing_desc': 'Liczby pojawiające się coraz częściej',
        'decreasing_desc': 'Liczby pojawiające się coraz rzadziej',
        'no_increasing_trends': 'Nie znaleziono istotnych trendów wzrostowych',
        'no_decreasing_trends': 'Nie znaleziono istotnych trendów spadkowych',
        'time_series_chart': 'Częstość w czasie',
        'chart_info': 'Wykres liniowy pokazujący zmiany częstości w okresach',
        'streak_analysis_title': 'Analiza serii',
        'hot_streaks': 'Gorące serie',
        'cold_streaks': 'Zimne serie',
        'hot_streaks_desc': 'Liczby obecnie na seriach występowania',
        'cold_streaks_desc': 'Liczby nieobecne przez wiele losowań',
        'consecutive_draws': 'kolejnych losowań',
        'draws_absent': 'losowań nieobecna',
        'max_streak': 'Maks. seria',
        'max_absence': 'Maks. nieobecność',
        'no_hot_streaks': 'Brak aktywnych gorących serii',
        'no_cold_streaks': 'Brak znaczących zimnych serii',
        'longest_appearance': 'Najdłuższa seria występowania',
        'longest_absence': 'Najdłuższa nieobecność',
        'insights_title': 'Wnioski',
        'trend_interpretation': 'Interpretacja trendów',
        'increasing_trend': 'Trend rosnący',
        'decreasing_trend': 'Trend malejący',
        'stable_trend': 'Wzorzec stabilny',
        'increasing_interpretation': 'Liczba pojawia się częściej w ostatnich okresach',
        'decreasing_interpretation': 'Liczba pojawia się rzadziej w ostatnich okresach',
        'stable_interpretation': 'Brak istotnych zmian w częstości występowania',
        'statistical_method': 'Metoda statystyczna',
        'trend_method_desc': 'Trendy są obliczane za pomocą regresji liniowej na częstościach okresowych.',
        'r_squared_desc': 'R² wskazuje jak dobrze linia trendu dopasowuje się do danych (1.0 = idealne dopasowanie).',
        'important_note': 'Ważna uwaga',
        'gambler_fallacy_warning': 'Przeszłe trendy nie przewidują przyszłych wyników. To błąd hazardzisty. Każde losowanie jest niezależne i losowe.',
        'number_label': 'Liczba',
        'frequency_over_time': 'Częstość liczb w czasie',
        'period_label': 'Okres',
        'frequency_label': 'Częstość',
        # Export
        'export_reports': 'Eksport raportów',
        'download_pdf': 'Pobierz PDF',
        'download_excel': 'Pobierz Excel',
        # Progress Bar
        'prev_topic': 'Poprzedni temat',
        'next_topic': 'Następny temat',
        'progress_text': 'z 7 tematów',
        # Right Panel
        'on_this_page': 'Na tej stronie',
        'related_topics': 'Powiązane tematy',
        'additional_materials': 'Dodatkowe materiały',
        'binomial_distribution': 'Rozkład dwumianowy',
        'law_of_large_numbers': 'Prawo wielkich liczb',
        'central_limit_theorem': 'Centralne twierdzenie graniczne',
        # Monte Carlo Demo
        'monte_carlo_title': 'Symulacja Monte Carlo',
        'monte_carlo_desc': 'Przeprowadź wiele symulacji i obserwuj zbieżność do rozkładu teoretycznego.',
        'num_simulations': 'Liczba symulacji',
        'run_simulation': 'Uruchom symulację',
        'running': 'Trwa...',
        'sim_chi_square': 'Śr. χ²',
        'sim_p_value': 'Śr. p-value',
        'sim_random_pct': '% losowych',
        # Hypothesis Testing
        'hypothesis_test_title': 'Test hipotezy statystycznej',
        'null_hypothesis': 'Hipoteza zerowa (H₀)',
        'alt_hypothesis': 'Hipoteza alternatywna (H₁)',
        'h0_value': 'Rozkład równomierny',
        'h0_desc': 'Rozkład liczb w loterii jest zgodny z rozkładem równomiernym z równym prawdopodobieństwem dla każdej liczby.',
        'h1_value': 'Rozkład nierównomierny',
        'h1_desc': 'Rozkład liczb w loterii wykazuje nielosowe wzorce lub odchylenia od rozkładu równomiernego.',
        'fail_to_reject': 'BRAK PODSTAW DO ODRZUCENIA',
        'rejected': 'NIEISTOTNE',
        # Formula Box
        'formula_section_title': 'Metody statystyczne',
        'formula_chi_square_title': 'Test chi-kwadrat dopasowania:',
        'formula_chi_square': 'χ² = Σ [(O - E)² / E]',
        'formula_chi_square_desc': 'O = częstość obserwowana, E = częstość oczekiwana',
        'formula_entropy_title': 'Entropia Shannona:',
        'formula_entropy': 'H = -Σ p(x) · log₂ p(x)',
        'formula_entropy_desc': 'p(x) = prawdopodobieństwo wystąpienia liczby x',
        # Stats Grid
        'key_metrics': 'Kluczowe metryki',
        'stat_sample_size': 'Wielkość próby',
        'stat_sample_desc': 'Historycznych losowań przeanalizowanych',
        'stat_observations': 'Obserwacje',
        'stat_observations_desc': 'Łącznie wylosowanych liczb',
        'stat_chi_square': 'Test Chi-kwadrat',
        'stat_entropy': 'Poziom entropii',
        'stat_entropy_unit': 'Entropia Shannona (bity)',
        'stat_coverage': 'Pokrycie liczb',
        'stat_coverage_desc': 'Wszystkie 49 liczb reprezentowanych',
        'stat_confidence': 'Przedział ufności',
        'stat_confidence_desc': '95% CI dla rozkładu częstości',
        # Homepage
        'features': 'Funkcje',
        'how_it_works': 'Jak to działa',
        'methodology': 'Metodologia',
        'docs': 'Dokumentacja',
        'toggle_theme': 'Przełącz motyw',
        'open_analyzer': 'Otwórz analizator',
        'hero_title_1': 'Gdzie',
        'hero_title_highlight': 'szczęście',
        'hero_title_2': 'spotyka naukę',
        'hero_subtitle': 'Poznaj matematyczne tajniki loterii. Analizuj 68 lat historycznych danych, testuj hipotezy statystyczne i odkryj, dlaczego losowość jest piękna.',
        'disclaimer_title': 'To nie jest system do przewidywania wyników.',
        'disclaimer_text': 'Lottery Lab to narzędzie edukacyjne do analizy statystycznej. Wyniki loterii są losowe i nieprzewidywalne — i właśnie to badamy.',
        'start_analysis': 'Rozpocznij analizę',
        'learn_more': 'Dowiedz się więcej',
        'stat_draws': 'Historycznych losowań',
        'years': 'lat',
        'stat_data_since': 'Danych od 1957',
        'stat_methods': 'Metod statystycznych',
        'hottest': 'Najczęstsza',
        'coldest': 'Najrzadsza',
        'chi_square': 'Test χ²',
        'entropy': 'Entropia',
        'features_title': 'Co możesz zbadać?',
        'features_subtitle': 'Zestaw narzędzi statystycznych do rzetelnej analizy danych loteryjnych',
        'feature_frequency_title': 'Analiza częstości',
        'feature_frequency_desc': 'Sprawdź jak często wypadają poszczególne liczby. Porównaj z rozkładem teoretycznym i zobacz "gorące" oraz "zimne" numery.',
        'feature_randomness_title': 'Testy losowości',
        'feature_randomness_desc': 'Chi-kwadrat, Kołmogorow-Smirnow, test serii — sprawdź czy losowania rzeczywiście są losowe.',
        'feature_patterns_title': 'Wzorce i sekwencje',
        'feature_patterns_desc': 'Szukaj sekwencji kolejnych liczb, ciągów arytmetycznych i innych potencjalnych wzorców.',
        'feature_correlation_title': 'Mapa korelacji',
        'feature_correlation_desc': 'Wizualizacja zależności między liczbami. Czy niektóre pary pojawiają się razem częściej niż losowo?',
        'feature_trends_title': 'Trendy czasowe',
        'feature_trends_desc': 'Analiza zmian w czasie — tygodniowe, miesięczne i kwartalne trendy częstości występowania.',
        'feature_generator_title': 'Generator liczb',
        'feature_generator_desc': 'Losuj zestawy liczb z różnymi strategiami. Pamiętaj: każda kombinacja ma takie samo prawdopodobieństwo!',
        'explore': 'Eksploruj',
        'test': 'Testuj',
        'analyze': 'Analizuj',
        'view_map': 'Zobacz mapę',
        'observe': 'Obserwuj trendy',
        'generate': 'Generuj',
        'how_it_works_title': 'Jak to działa?',
        'how_it_works_subtitle': 'Rzetelne podejście naukowe w 4 krokach',
        'step1_title': 'Zbieramy dane',
        'step1_desc': 'Historyczne wyniki od 1957 roku, aktualizowane automatycznie po każdym losowaniu.',
        'step2_title': 'Formułujemy hipotezę',
        'step2_desc': 'H₀: "Wyniki loterii są całkowicie losowe" — to badamy statystycznie.',
        'step3_title': 'Przeprowadzamy testy',
        'step3_desc': 'Stosujemy uznane metody statystyczne: chi-kwadrat, KS, autokorelacja, entropia.',
        'step4_title': 'Interpretujemy wyniki',
        'step4_desc': 'Czy dane wspierają losowość? (Spoiler: tak — i to jest dobra wiadomość!)',
        'footer_tagline': 'Badania i Edukacja. Projekt open-source na licencji MIT.',
        # Methodology Page
        'home': 'Strona główna',
        'analyzer': 'Analizator',
        'meth_scientific_approach': 'Naukowe podejście do analizy',
        'meth_title': 'Metodologia badawcza',
        'meth_subtitle': 'Poznaj metody statystyczne, które pozwalają rzetelnie zbadać losowość wyników loterii. Każda metoda oparta na uznanej teorii matematycznej.',
        'meth_stat_methods': 'Metod statystycznych',
        'meth_significance_level': 'Poziom istotności',
        'meth_historical_data': 'Danych historycznych',
        'meth_null_hypothesis': 'Hipoteza zerowa (H₀)',
        'meth_h0_text_1': 'Wyniki loterii są',
        'meth_h0_highlight_1': 'całkowicie losowe',
        'meth_h0_text_2': 'i',
        'meth_h0_highlight_2': 'niezależne',
        'meth_h0_text_3': 'każda liczba ma takie samo prawdopodobieństwo wylosowania.',
        'meth_h0_desc': 'To właśnie testujemy. Jeśli dane nie dają podstaw do odrzucenia H₀, loteria działa prawidłowo. I właśnie to obserwujemy!',
        'meth_methods_title': 'Metody analizy',
        'meth_methods_subtitle': 'Kliknij na kartę, aby poznać szczegóły danej metody',
        'meth_chi_title': 'Test Chi-kwadrat',
        'meth_chi_question': 'Czy rozkład częstości jest równomierny?',
        'meth_chi_desc': 'Porównuje obserwowane częstości z oczekiwanymi. Sprawdza, czy odchylenia są w granicach naturalnej zmienności losowej.',
        'meth_ks_title': 'Test Kołmogorowa-Smirnowa',
        'meth_ks_question': 'Czy dystrybuanta pasuje do teoretycznej?',
        'meth_ks_desc': 'Porównuje empiryczną dystrybuantę z teoretyczną. Czuły na różnice w kształcie rozkładu, nie tylko średniej.',
        'meth_runs_title': 'Test serii (Runs Test)',
        'meth_runs_question': 'Czy sekwencje są losowe?',
        'meth_runs_desc': 'Sprawdza czy występują zbyt długie serie (np. same wysokie liczby z rzędu). Wykrywa ukryte wzorce w kolejności wyników.',
        'meth_autocorr_title': 'Autokorelacja',
        'meth_autocorr_question': 'Czy przeszłość wpływa na przyszłość?',
        'meth_autocorr_desc': 'Mierzy zależności między wynikami oddalonymi w czasie. Jeśli loteria jest losowa, autokorelacja powinna być bliska zeru.',
        'meth_entropy_title': 'Entropia Shannona',
        'meth_entropy_question': 'Jak nieprzewidywalne są wyniki?',
        'meth_entropy_desc': 'Mierzy "ilość zaskoczenia" w danych. Maksymalna entropia = maksymalna losowość. Dla Lotto 6/49: max = 5.61 bitów.',
        'meth_monte_title': 'Symulacje Monte Carlo',
        'meth_monte_question': 'Co gdybyśmy powtórzyli 10 000 razy?',
        'meth_monte_desc': 'Generujemy tysiące sztucznych losowań i porównujemy z rzeczywistymi. Pokazuje, że prawdziwe dane mieszczą się w granicach symulacji.',
        'meth_monte_formula': 'Symulacja → Porównanie → Wnioski',
        'meth_for_lotto': 'dla Lotto PL',
        'meth_no_significant_lags': 'Brak istotnych lagów',
        'meth_data_in_ci': 'Dane w 95% CI',
        'meth_read_more': 'Czytaj więcej',
        'meth_workflow_title': 'Jak przeprowadzamy analizę?',
        'meth_step1': 'Zbieramy dane',
        'meth_step1_desc': 'Historyczne wyniki z oficjalnych źródeł',
        'meth_step2': 'Walidujemy',
        'meth_step2_desc': 'Sprawdzamy poprawność i kompletność',
        'meth_step3': 'Testujemy',
        'meth_step3_desc': 'Stosujemy wszystkie 6 metod statystycznych',
        'meth_step4': 'Wizualizujemy',
        'meth_step4_desc': 'Prezentujemy wyniki w przystępny sposób',
        'meth_lotteries_title': 'Obsługiwane loterie',
        'meth_lotteries_subtitle': 'Metodologia jest uniwersalna — działa dla każdej loterii liczbowej',
        'meth_status_active': 'Aktywne',
        'meth_status_soon': 'Wkrótce',
        'meth_status_planned': 'Planowane',
        'meth_cta_title': 'Gotowy na analizę?',
        'meth_cta_desc': 'Wypróbuj wszystkie metody na rzeczywistych danych. Przekonaj się sam, że loteria jest uczciwa!',
        'meth_start_basics': 'Zacznij od podstaw',
        # Chi-square detail page
        'meth_tests_title': 'Testy statystyczne',
        'meth_your_progress': 'Twój postęp',
        'meth_of': 'z',
        'meth_chapters': 'rozdziałów',
        'chi_subtitle': 'Sprawdź czy rozkład częstości liczb jest zgodny z rozkładem teoretycznym. Jeden z najpotężniejszych testów losowości.',
        'chi_intuition_title': 'Intuicja',
        'chi_intuition_p1': 'Wyobraź sobie, że rzucasz kostką 600 razy. Jeśli kostka jest uczciwa, każda liczba powinna wypaść około 100 razy (600 ÷ 6).',
        'chi_intuition_p2': 'Ale czy dokładnie 100? Nie! Losowość oznacza, że będą naturalne odchylenia. Może 95 jedynek, 108 dwójek, 97 trójek...',
        'chi_intuition_question': 'Test chi-kwadrat odpowiada na pytanie:',
        'chi_intuition_answer': '"Czy te odchylenia są w granicach tego, czego oczekiwalibyśmy od uczciwej kostki, czy są podejrzanie duże?"',
        'chi_accept_h0': 'Akceptujemy H₀',
        'chi_accept_desc': 'Odchylenia są normalne dla losowego procesu',
        'chi_reject_h0': 'Odrzucamy H₀',
        'chi_reject_desc': 'Odchylenia są zbyt duże — coś jest nie tak',
        'chi_formula_title': 'Wzór matematyczny',
        'chi_statistic': 'Statystyka chi-kwadrat',
        'chi_observed': 'częstość obserwowana',
        'chi_expected': 'częstość oczekiwana',
        'chi_formula_explanation': 'Dla każdej liczby od 1 do 49 obliczamy różnicę między tym, ile razy wypadła (Obserwowane), a tym ile powinna wypaść (Oczekiwane). Podnosimy do kwadratu (aby pozbyć się minusów) i dzielimy przez oczekiwaną wartość (normalizacja).',
        'chi_step1_title': 'Policz częstości',
        'chi_step1_desc': 'Dla każdej z 49 liczb policz ile razy wypadła w analizowanym okresie',
        'chi_step2_title': 'Oblicz oczekiwane',
        'chi_step2_desc': 'E = (liczba losowań × 6) ÷ 49 — tyle razy powinna wypaść każda liczba',
        'chi_step3_title': 'Podstaw do wzoru',
        'chi_step3_desc': 'Dla każdej liczby oblicz (O-E)²/E i zsumuj wszystkie wyniki',
        'chi_step4_title': 'Porównaj z rozkładem χ²',
        'chi_step4_desc': 'Sprawdź p-value: jeśli > 0.05, dane są zgodne z losowością',
        'chi_demo_title': 'Spróbuj sam',
        'chi_simulator_title': 'Symulator testu chi-kwadrat',
        'chi_simulator_desc': 'Przeprowadź wirtualne losowania i zobacz wyniki',
        'chi_num_draws': 'Liczba losowań',
        'chi_run_simulation': 'Uruchom symulację',
        'chi_verdict': 'Werdykt',
        'chi_random': 'LOSOWE',
        'chi_suspicious': 'PODEJRZANE',
        'chi_interpret_title': 'Jak interpretować wyniki?',
        'chi_lotto_result': 'Wynik dla polskiego Lotto (9300+ losowań)',
        'chi_lotto_result_desc': 'Dla historycznych danych Lotto otrzymujemy p-value ≈ 0.52, co oznacza, że nie ma podstaw do odrzucenia hipotezy o losowości. Rozkład liczb jest zgodny z oczekiwanym — loteria jest uczciwa!',
        'chi_warning_title': 'Uwaga na błędną interpretację',
        'chi_warning_desc': 'Wysoka wartość p-value NIE oznacza, że możemy przewidzieć przyszłe wyniki. Wręcz przeciwnie — potwierdza, że każde losowanie jest niezależne i nieprzewidywalne. To dobra wiadomość: loteria działa tak, jak powinna!',
        'chi_code_title': 'Implementacja',
        'chi_code_docstring': 'Test chi-kwadrat dla rozkładu częstości.',
        'chi_code_comment1': 'równy rozkład',
        'chi_code_comment2': 'stopnie swobody',
        'chi_on_this_page': 'Na tej stronie',
        'chi_tip_text': 'Im większa próbka (więcej losowań), tym bardziej wiarygodny test. Dla 100 losowań wynik może być przypadkowy; dla 9000+ jest bardzo pewny.',
        'chi_related': 'Powiązane tematy',
    }
}


def t(key: str, lang: str = DEFAULT_LANGUAGE) -> str:
    """
    Get translated text by key.
    
    Args:
        key: Translation key
        lang: Language code
        
    Returns:
        Translated text or key if not found
    """
    if lang not in UI_TEXTS:
        lang = DEFAULT_LANGUAGE
    return UI_TEXTS.get(lang, {}).get(key, key)


def get_all_texts(lang: str = DEFAULT_LANGUAGE) -> dict:
    """
    Get all UI texts for a language.
    
    Args:
        lang: Language code
        
    Returns:
        Dictionary of all UI texts
    """
    if lang not in UI_TEXTS:
        lang = DEFAULT_LANGUAGE
    return UI_TEXTS.get(lang, UI_TEXTS[DEFAULT_LANGUAGE])

